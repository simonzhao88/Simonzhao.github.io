{"title":"CentOS7.2下安装MySQL5.7","slug":"CentOS7-2下安装MySQL5-7","date":"2018-05-26T07:14:31.000Z","updated":"2018-05-26T07:51:07.623Z","comments":true,"path":"api/articles/CentOS7-2下安装MySQL5-7.json","photos":[],"link":"","excerpt":"CentOS7.2 安装mysql5.7初始密码问题总结CentOS 7之后的版本yum的默认源中使用MariaDB替代原先MySQL。这对于想要使用MySQL的朋友来说，安装MySQL就比较麻烦了，笔者看了网上很多的教程，感觉不是很友好，幸运的是经过几天的摸索，笔者终于成功的装上了MySQL，现将安装的经验总结如下。","covers":null,"content":"<h2 id=\"CentOS7-2-安装mysql5-7初始密码问题总结\"><a href=\"#CentOS7-2-安装mysql5-7初始密码问题总结\" class=\"headerlink\" title=\"CentOS7.2 安装mysql5.7初始密码问题总结\"></a>CentOS7.2 安装mysql5.7初始密码问题总结</h2><p>CentOS 7之后的版本yum的默认源中使用MariaDB替代原先MySQL。这对于想要使用MySQL的朋友来说，安装MySQL就比较麻烦了，笔者看了网上很多的教程，感觉不是很友好，幸运的是经过几天的摸索，笔者终于成功的装上了MySQL，现将安装的经验总结如下。</p>\n<a id=\"more\"></a>\n<h3 id=\"1、下载mysql的源\"><a href=\"#1、下载mysql的源\" class=\"headerlink\" title=\"1、下载mysql的源\"></a>1、下载mysql的源</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n<p>###2、创建组、用户</p>\n<p>建立用户mysql，组mysql。后面mysql就使用这个用户来运行（注意这也是mysql启动脚本中默认的用户，因此最好不要改名）。<br>groupadd mysql<br>useradd -r -g mysql mysql   -  （使用-r参数表示mysql用户是一个系统用户，不能登录）</p>\n<h3 id=\"3、安装\"><a href=\"#3、安装\" class=\"headerlink\" title=\"3、安装\"></a>3、安装</h3><h4 id=\"3-1-解压\"><a href=\"#3-1-解压\" class=\"headerlink\" title=\"3.1 解压\"></a>3.1 解压</h4><p>将前面得到的mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz 解压、解归档<br>gunzip mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz<br>tar -xvf mysql-5.7.22-linux-glibc2.12-x86_64.tar<br>将解压后的目录移动至 /usr/local ，并重命名为 mysql<br>mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql<br>此后 /usr/local/mysql 就是安装目录了<br>注意，如果mysql目录下没有data和tmp目录，手动新建，并修改权限</p>\n<h4 id=\"3-2-目录权限设置\"><a href=\"#3-2-目录权限设置\" class=\"headerlink\" title=\"3.2 目录权限设置\"></a>3.2 目录权限设置</h4><p>将mysql及其下所有的目录所有者和组均设为mysql:<br>cd /usr/local/mysql<br>chown mysql:mysql -R .</p>\n<h4 id=\"3-3-初始化\"><a href=\"#3-3-初始化\" class=\"headerlink\" title=\"3.3 初始化\"></a>3.3 初始化</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/mysql/bin/mysqld --initialize --user=mysql --datadir=/usr/local/mysql/data --basedir=/usr/local/mysql</span><br><span class=\"line\"><span class=\"comment\"># 初始化成功后出现如下信息：</span></span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xxT07:<span class=\"number\">10</span>:<span class=\"number\">13.583130</span>Z <span class=\"number\">0</span> [Warning] TIMESTAMP <span class=\"keyword\">with</span> implicit DEFAULT value <span class=\"keyword\">is</span> deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation <span class=\"keyword\">for</span> more details).</span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xx T07:<span class=\"number\">10</span>:<span class=\"number\">13.976219</span>Z <span class=\"number\">0</span> [Warning] InnoDB: New log files created, LSN=<span class=\"number\">45790</span></span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xx T07:<span class=\"number\">10</span>:<span class=\"number\">14.085666</span>Z <span class=\"number\">0</span> [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xx T07:<span class=\"number\">10</span>:<span class=\"number\">14.161899</span>Z <span class=\"number\">0</span> [Warning] No existing UUID has been found, so we assume that this <span class=\"keyword\">is</span> the first time that this server has been started. Generating a new UUID: <span class=\"number\">1</span>fa941f9-effd<span class=\"number\">-11e5</span>-b67d<span class=\"number\">-000</span>c2958cdc8.</span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xx T07:<span class=\"number\">10</span>:<span class=\"number\">14.165534</span>Z <span class=\"number\">0</span> [Warning] Gtid table <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> ready to be used. Table <span class=\"string\">'mysql.gtid_executed'</span> cannot be opened.</span><br><span class=\"line\"><span class=\"number\">201</span>x-xx-xx T07:<span class=\"number\">10</span>:<span class=\"number\">14.168555</span>Z <span class=\"number\">1</span> [Note] A temporary password <span class=\"keyword\">is</span> generated <span class=\"keyword\">for</span> root@localhost: xxxxxxxxx, </span><br><span class=\"line\"><span class=\"comment\"># 注意最后一行，它给了root一个初始密码，后面要登录的时候要用到这个密码。</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"3-4-配置\"><a href=\"#3-4-配置\" class=\"headerlink\" title=\"3.4 配置\"></a>3.4 配置</h4><p>配置 /etc 下的 my.cnf 文件，如果没有请创建</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">basedir = /usr/local/mysql</span><br><span class=\"line\">datadir = /usr/local/mysql/data</span><br><span class=\"line\">port = <span class=\"number\">3306</span></span><br><span class=\"line\">socket = /usr/local/mysql/tmp/mysql.sock</span><br><span class=\"line\"> </span><br><span class=\"line\">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">socket = /usr/local/mysql/tmp/mysql.sock</span><br></pre></td></tr></table></figure>\n<h3 id=\"4、后台运行服务端\"><a href=\"#4、后台运行服务端\" class=\"headerlink\" title=\"4、后台运行服务端\"></a>4、后台运行服务端</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">注意：请将&#123;mysql&#125; 替换成 mysql安装路径</span><br><span class=\"line\">&#123;mysql&#125;/bin/mysqld_safe &amp;</span><br><span class=\"line\">ps -ef | grep mysql   或者  netstat -nap | grep <span class=\"number\">3306</span>    - 查看进程</span><br><span class=\"line\">&#123;mysql&#125;/bin/mysqladmin -uroot -p          - 停止</span><br></pre></td></tr></table></figure>\n<h3 id=\"5、设置mysql以服务运行并且开机启动\"><a href=\"#5、设置mysql以服务运行并且开机启动\" class=\"headerlink\" title=\"5、设置mysql以服务运行并且开机启动\"></a>5、设置mysql以服务运行并且开机启动</h3><p>将{mysql}/ support-files/mysql.server 拷贝为/etc/init.d/mysql并设置运行权限</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp mysql.server /etc/init.d/mysql</span><br><span class=\"line\">chmod +x /etc/init.d/mysql</span><br><span class=\"line\"><span class=\"comment\"># 把mysql注册为开机启动的服务</span></span><br><span class=\"line\">chkconfig --add mysql</span><br><span class=\"line\"><span class=\"comment\"># 当然也可以手动进行服务的开启和关闭：</span></span><br><span class=\"line\">/etc/init.d/mysql start</span><br><span class=\"line\">/etc/init.d/mysql stop</span><br></pre></td></tr></table></figure>\n<h3 id=\"6、连接客户端\"><a href=\"#6、连接客户端\" class=\"headerlink\" title=\"6、连接客户端\"></a>6、连接客户端</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 将客户端软链接到 /usr/local/bin</span></span><br><span class=\"line\">ln -s &#123;mysql&#125;/bin/mysql /usr/local/bin/mysql</span><br><span class=\"line\"><span class=\"comment\"># 客户端连接</span></span><br><span class=\"line\">mysql -u root -p</span><br><span class=\"line\"><span class=\"comment\"># 输入刚才的初始化密码进入</span></span><br><span class=\"line\"><span class=\"comment\"># 进入之后，修改密码</span></span><br><span class=\"line\">mysql&gt; alter user <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> identified by <span class=\"string\">'xxxxxxx'</span>;</span><br><span class=\"line\"><span class=\"comment\"># 配置远程可以连接</span></span><br><span class=\"line\">use mysql                <span class=\"comment\"># 打开mysql数据库  </span></span><br><span class=\"line\"><span class=\"comment\"># 将host设置为%表示任何ip都能连接mysql，当然也可以将host指定为某个ip  </span></span><br><span class=\"line\">update user set host=<span class=\"string\">'%'</span> where user=<span class=\"string\">'root'</span> <span class=\"keyword\">and</span> host=<span class=\"string\">'localhost'</span>;  </span><br><span class=\"line\">flush privileges;        <span class=\"comment\">#刷新权限表，使配置生效 </span></span><br><span class=\"line\">关闭远程连接，恢复mysql的默认设置（只能本地连接）</span><br><span class=\"line\"><span class=\"comment\"># 将host设置为localhost表示只能本地连接mysql  </span></span><br><span class=\"line\">update user set host=<span class=\"string\">'localhost'</span> where user=<span class=\"string\">'root'</span>;  </span><br><span class=\"line\"><span class=\"comment\"># 也可以添加一个用户名为aaa，密码为xxx，权限为%（表示任意ip都能连接）的远程连接用户</span></span><br><span class=\"line\">grant all on *.* to <span class=\"string\">'aaa'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">'xxx'</span>;</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"Linux","slug":"Linux","count":3,"path":"api/categories/Linux.json"}],"tags":[{"name":"Linux","slug":"Linux","count":2,"path":"api/tags/Linux.json"}]}